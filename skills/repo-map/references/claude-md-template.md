# CLAUDE.md Agent Memory Template

Write `CLAUDE.md` at the scan root following this structure. This file must be self-contained enough for a new agent session to orient itself without reading source code.

## File Structure

```markdown
# {Scan Root Name} -- Repository Landscape

> Auto-generated by repo-map. Agent memory file indexing all projects under this root.

## Project Inventory

| Project | Path | Stack | Database | Entry Point |
|---------|------|-------|----------|-------------|
| ProjectA | ./src/ProjectA | .NET 8, ASP.NET Core | PostgreSQL (appdb) | Program.cs |
| ProjectB | ./services/frontend | Node 20, React 18 | -- | index.tsx |

## Service Map

` ` `mermaid
graph LR
    Frontend["Frontend<br/>React 18"] -->|HTTP| API["API<br/>ASP.NET Core"]
    API -->|EF Core| DB[(PostgreSQL<br/>appdb)]
    API -->|RabbitMQ| Worker["Worker<br/>.NET Background Service"]
    Worker -->|EF Core| DB
` ` `

## Stack Summary

### {Project Name}

- **Runtime:** .NET 8
- **Framework:** ASP.NET Core Web API
- **ORM:** Entity Framework Core
- **Database:** PostgreSQL (appdb)
- **Infrastructure:** Docker, Docker Compose
- **Key paths:** `src/Api/Controllers/`, `src/Domain/Entities/`, `src/Infrastructure/Data/`
- **Entry point:** `src/Api/Program.cs`

## Cross-Project Dependencies

- **Shared databases:** {DB name} used by {Project A}, {Project B}
- **Inter-service calls:** {Project A} calls {Project B} at `http://service-b:5001/api/...`
- **Shared packages:** {Package name} published from `./libs/shared` consumed by {Project A}, {Project C}
- **Docker compose:** {compose file path} orchestrates {Service A}, {Service B}, {DB}, {Message Broker}

## Databases

| Name | Engine | Projects | Connection Key |
|------|--------|----------|---------------|
| appdb | PostgreSQL | API, Worker | ConnectionStrings__DefaultConnection |

## Environment Variables

| Variable | Used By | Purpose |
|----------|---------|---------|
| ConnectionStrings__DefaultConnection | API, Worker | PostgreSQL connection |
| RabbitMQ__Host | API, Worker | Message broker host |
| JWT__Secret | API | Token signing key |

## Conventions Detected

- {Naming patterns observed: PascalCase classes, kebab-case endpoints, etc.}
- {Architecture patterns: Clean Architecture layers, vertical slices, etc.}
- {Error handling patterns: Result<T>, ProblemDetails, etc.}

## Domain Glossary

| Term | Definition | Found In |
|------|-----------|----------|
| {Term} | {Definition inferred from code} | {Project/file} |

## Documentation Index

| Document | Path | Content |
|----------|------|---------|
| Database Diagrams | docs/database/diagrams.md | Mermaid ERDs for all databases |
| API Endpoints | docs/endpoints.md | Full endpoint catalog |
| Workflows | docs/workflows.md | Application flow diagrams |
| Supplementary Diagrams | docs/diagrams/ | Additional architecture diagrams |
```

## Rules

- Every discovered project MUST appear in the Project Inventory table.
- The Service Map diagram must show all inter-project relationships (HTTP calls, shared DBs, message brokers).
- Stack Summary must include key paths and entry points for each project.
- Environment variables section lists all required env vars found across projects.
- Domain Glossary captures ubiquitous language terms found in entity names, enum values, and comments.
- Conventions section documents patterns detected in the codebase (naming, architecture, error handling).
- Documentation Index links to all generated docs files.
