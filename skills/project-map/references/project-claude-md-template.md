# Project-Level CLAUDE.md Template

Write `CLAUDE.md` at the project root following this structure. This file aggregates all repository-level docs into a single project-wide agent memory file.

## File Structure

```markdown
# {Project Name} -- Project Landscape

> Auto-generated by project-map. Project-level agent memory aggregating {N} repositories.

## Repository Inventory

| Repository | Path | Stack | Database | Type |
|------------|------|-------|----------|------|
| RepoA | ./repo-a | .NET 8, ASP.NET Core | PostgreSQL (appdb) | API |
| RepoB | ./repo-b | Node 20, React 18 | -- | Frontend |
| RepoC | ./repo-c | .NET 8, Background Service | PostgreSQL (appdb) | Worker |

## Service Map

` ` `mermaid
graph LR
    subgraph Frontend
        WebApp["WebApp<br/>React 18"]
    end
    subgraph APIs
        ApiA["RepoA API<br/>ASP.NET Core"]
        ApiB["RepoB API<br/>Express"]
    end
    subgraph Workers
        Worker["RepoC<br/>Background Service"]
    end
    subgraph Data
        DB[(PostgreSQL<br/>appdb)]
        Cache[(Redis)]
        Broker[/RabbitMQ/]
    end

    WebApp -->|HTTP| ApiA
    ApiA -->|HTTP| ApiB
    ApiA -->|EF Core| DB
    ApiA -->|publish| Broker
    Worker -->|consume| Broker
    Worker -->|EF Core| DB
    ApiB -->|cache| Cache
` ` `

## Stack Summary per Repository

### {Repo Name}

- **Runtime:** .NET 8
- **Framework:** ASP.NET Core Web API
- **ORM:** Entity Framework Core
- **Database:** PostgreSQL (appdb)
- **Infrastructure:** Docker
- **Repo docs:** See `{repo-path}/CLAUDE.md` and `{repo-path}/docs/`

*(Repeat per repository)*

## Cross-Repository Dependencies

### Shared Databases

| Database | Engine | Repositories | Connection Key |
|----------|--------|--------------|---------------|
| appdb | PostgreSQL | RepoA, RepoC | ConnectionStrings__DefaultConnection |

### Inter-Service Calls

| Source | Target | Protocol | Base URL |
|--------|--------|----------|----------|
| WebApp | RepoA API | HTTP | http://api-a:5000 |
| RepoA API | RepoB API | HTTP | http://api-b:5001 |

### Event/Message Flows

| Producer | Consumer | Broker | Topic/Queue |
|----------|----------|--------|-------------|
| RepoA | RepoC | RabbitMQ | order-events |

### Shared Packages

| Package | Source | Consumers |
|---------|--------|-----------|
| Shared.Contracts | ./libs/shared | RepoA, RepoC |

### Shared Authentication

| Pattern | Repositories | Details |
|---------|-------------|---------|
| JWT Bearer | RepoA, RepoB | Issuer: auth.example.com |

## Environment Variables (Consolidated)

| Variable | Used By | Purpose |
|----------|---------|---------|
| ConnectionStrings__DefaultConnection | RepoA, RepoC | PostgreSQL connection |
| RabbitMQ__Host | RepoA, RepoC | Message broker host |
| JWT__Secret | RepoA, RepoB | Token signing key |

## Conventions (Cross-Repo)

- {Common naming patterns across repos}
- {Shared architecture patterns}
- {Common error handling approaches}

## Domain Glossary (Consolidated)

| Term | Definition | Source Repo |
|------|-----------|-------------|
| {Term} | {Definition} | {Repo} |

## Mapping Gaps

| Repository | Issue |
|------------|-------|
| {Repo} | {Reason for failure or incomplete mapping} |

*(Omit section if all repos mapped successfully)*

## Documentation Index

### Project-Level Docs

| Document | Path | Content |
|----------|------|---------|
| Database Diagrams | docs/database/diagrams.md | Consolidated ER diagrams across all repos |
| API Endpoints | docs/endpoints.md | All endpoints grouped by repository |
| Cross-Repo Workflows | docs/workflows.md | Sequences spanning multiple services |
| Service Map | docs/diagrams/service-map.md | Full service topology diagram |
| Deployment | docs/diagrams/deployment.md | Deployment topology (if found) |

### Repository-Level Docs

| Repository | CLAUDE.md | Docs Directory |
|------------|-----------|---------------|
| RepoA | repo-a/CLAUDE.md | repo-a/docs/ |
| RepoB | repo-b/CLAUDE.md | repo-b/docs/ |
```

## Rules

- Every discovered repository MUST appear in the Repository Inventory table.
- Service Map diagram shows ALL cross-repo connections (HTTP, shared DBs, message brokers, events).
- Stack Summary links to each repo's own CLAUDE.md and docs for drill-down.
- Cross-Repository Dependencies sections only include relationships that span multiple repos.
- Mapping Gaps section is only present when at least one repo failed mapping.
- Documentation Index links to both project-level AND repo-level docs.
- Back up any existing CLAUDE.md to `.bak` before writing.
